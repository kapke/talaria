define(["require", "exports", 'es6-promise'], function (require, exports, rsvp) {
    var Promise = rsvp.Promise;
    var Repository = (function () {
        function Repository(entityInfo, unitOfWork, persistenceStrategy) {
            this.cache = [];
            this.entityInfo = entityInfo;
            this.unitOfWork = unitOfWork;
            this.persistenceStrategy = persistenceStrategy;
        }
        Repository.prototype.add = function (obj) {
            var _this = this;
            return new Promise(function (resolve, reject) {
                var registered = _this.unitOfWork.registerNew(_this.entityInfo, obj);
                _this.cache.push(registered);
                resolve(registered);
            });
        };
        Repository.prototype.remove = function (obj) {
            var _this = this;
            return this.has(obj).then(function (result) {
                if (result) {
                    _this.cache.splice(_this.cache.indexOf(obj), 1);
                    _this.unitOfWork.registerDeleted(_this.entityInfo, obj);
                }
            });
        };
        Repository.prototype.findOne = function () {
            throw new Error('Not implemented yet');
        };
        Repository.prototype.findAll = function () {
            var _this = this;
            return this.persistenceStrategy.find(this.entityInfo, null).then(function (found) {
                found.forEach(function (item) {
                    if (_this.cache.indexOf(item) == -1) {
                        _this.cache.push(item);
                    }
                });
                return _this.cache.slice();
            });
        };
        Repository.prototype.has = function (obj) {
            var _this = this;
            return new Promise(function (resolve, reject) {
                if (_this.cache.indexOf(obj) > -1) {
                    resolve(true);
                }
                else {
                    _this.persistenceStrategy.find(_this.entityInfo, obj).then(function (found) {
                        found.forEach(function (item) {
                            this.cache.push(item);
                        });
                        resolve(found.length > 0);
                    });
                }
            });
        };
        return Repository;
    })();
    return Repository;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJlcG9zaXRvcnkudHMiXSwibmFtZXMiOlsiUmVwb3NpdG9yeSIsIlJlcG9zaXRvcnkuY29uc3RydWN0b3IiLCJSZXBvc2l0b3J5LmFkZCIsIlJlcG9zaXRvcnkucmVtb3ZlIiwiUmVwb3NpdG9yeS5maW5kT25lIiwiUmVwb3NpdG9yeS5maW5kQWxsIiwiUmVwb3NpdG9yeS5oYXMiXSwibWFwcGluZ3MiOiIwRUFJTyxJQUFJO0lBQ1gsSUFBTyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUU5QixJQUFNLFVBQVU7UUFRZkEsU0FSS0EsVUFBVUEsQ0FRRkEsVUFBcUJBLEVBQUVBLFVBQXFCQSxFQUFFQSxtQkFBd0NBO1lBRnhGQyxVQUFLQSxHQUFPQSxFQUFFQSxDQUFDQTtZQUduQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsVUFBVUEsQ0FBQ0E7WUFDN0JBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLFVBQVVBLENBQUNBO1lBQzdCQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLG1CQUFtQkEsQ0FBQ0E7UUFDdERBLENBQUNBO1FBQ01ELHdCQUFHQSxHQUFWQSxVQUFXQSxHQUFNQTtZQUFqQkUsaUJBTUlBO1lBTEdBLE1BQU1BLENBQUNBLElBQUlBLE9BQU9BLENBQUlBLFVBQUNBLE9BQU9BLEVBQUVBLE1BQU1BO2dCQUNsQ0EsSUFBSUEsVUFBVUEsR0FBUUEsS0FBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsS0FBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3hFQSxLQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtnQkFDNUJBLE9BQU9BLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1lBQ3hCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNQQSxDQUFDQTtRQUNHRiwyQkFBTUEsR0FBYkEsVUFBY0EsR0FBT0E7WUFBckJHLGlCQU9JQTtZQU5HQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFDQSxNQUFnQkE7Z0JBQ3ZDQSxFQUFFQSxDQUFBQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDUkEsS0FBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzlDQSxLQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxlQUFlQSxDQUFDQSxLQUFJQSxDQUFDQSxVQUFVQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDMURBLENBQUNBO1lBQ0xBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBO1FBQ0dILDRCQUFPQSxHQUFkQTtZQUNPSSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxxQkFBcUJBLENBQUNBLENBQUNBO1FBQzNDQSxDQUFDQTtRQUNNSiw0QkFBT0EsR0FBZEE7WUFBQUssaUJBU0NBO1lBUkdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsS0FBVUE7Z0JBQ3hFQSxLQUFLQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFDQSxJQUFJQTtvQkFDZkEsRUFBRUEsQ0FBQUEsQ0FBQ0EsS0FBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ2hDQSxLQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtvQkFDMUJBLENBQUNBO2dCQUNMQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDSEEsTUFBTUEsQ0FBQ0EsS0FBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7WUFDOUJBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBO1FBQ0dMLHdCQUFHQSxHQUFWQSxVQUFXQSxHQUFNQTtZQUFqQk0saUJBYUlBO1lBWkdBLE1BQU1BLENBQUNBLElBQUlBLE9BQU9BLENBQVVBLFVBQUNBLE9BQU9BLEVBQUVBLE1BQU1BO2dCQUN4Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQy9CQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDbEJBLENBQUNBO2dCQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtvQkFDSkEsS0FBSUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFJQSxDQUFDQSxVQUFVQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFDQSxLQUFLQTt3QkFDM0RBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLFVBQVVBLElBQUlBOzRCQUN4QixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDMUIsQ0FBQyxDQUFDQSxDQUFDQTt3QkFDSEEsT0FBT0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzlCQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDUEEsQ0FBQ0E7WUFDTEEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUEEsQ0FBQ0E7UUFDTE4saUJBQUNBO0lBQURBLENBdkRBLEFBdURDQSxJQUFBO0lBRUQsQUFBb0IsT0FBWCxVQUFVLENBQUMiLCJmaWxlIjoiUmVwb3NpdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9rYXBrZS9wcm9qZWN0cy90YWxhcmlhLyIsInNvdXJjZXNDb250ZW50IjpbXX0=